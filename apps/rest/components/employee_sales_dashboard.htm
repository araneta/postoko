<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Sales Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        select, button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background-color: #007bff;
            color: white;
            cursor: pointer;
            border: none;
        }
        button:hover {
            background-color: #0056b3;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .metric-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }
        .metric-label {
            color: #666;
            font-size: 0.9em;
        }
        .employee-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .employee-table th,
        .employee-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .employee-table th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        .employee-table tr:hover {
            background-color: #f5f5f5;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .rank {
            display: inline-block;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #007bff;
            color: white;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 10px;
        }
        .rank.top3 {
            background-color: #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Employee Sales Dashboard</h1>
            <div class="filters">
                <div class="filter-group">
                    <label>Time Period:</label>
                    <select id="periodSelect">
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month" selected>This Month</option>
                        <option value="year">This Year</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>&nbsp;</label>
                    <button onclick="loadSalesData()">Refresh Data</button>
                </div>
            </div>
        </div>

        <div id="errorMessage" class="error" style="display: none;"></div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value" id="totalSales">$0</div>
                <div class="metric-label">Total Sales</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="totalOrders">0</div>
                <div class="metric-label">Total Orders</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="avgOrderValue">$0</div>
                <div class="metric-label">Avg Order Value</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="totalProfit">$0</div>
                <div class="metric-label">Total Profit</div>
            </div>
        </div>

        <div id="loadingMessage" class="loading">Loading employee sales data...</div>

        <table class="employee-table" id="employeeTable" style="display: none;">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Employee</th>
                    <th>Role</th>
                    <th>Total Sales</th>
                    <th>Orders</th>
                    <th>Avg Order</th>
                    <th>Profit</th>
                    <th>Margin %</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="employeeTableBody">
            </tbody>
        </table>
    </div>

    <script>
        // Mock API functions - replace with actual API calls
        async function fetchEmployeeSales(period) {
            // Simulate API call
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Mock data - replace with actual API call
            return [
                {
                    employeeId: "emp-1",
                    employeeName: "Alice Johnson",
                    employeeRole: "manager",
                    totalSales: "2450.75",
                    orderCount: 35,
                    averageOrderValue: "70.02",
                    totalProfit: "735.23",
                    profitMargin: 30.0
                },
                {
                    employeeId: "emp-2",
                    employeeName: "Bob Smith",
                    employeeRole: "cashier",
                    totalSales: "1890.50",
                    orderCount: 42,
                    averageOrderValue: "45.01",
                    totalProfit: "567.15",
                    profitMargin: 30.0
                },
                {
                    employeeId: "emp-3",
                    employeeName: "Carol Davis",
                    employeeRole: "cashier",
                    totalSales: "1650.25",
                    orderCount: 28,
                    averageOrderValue: "58.94",
                    totalProfit: "495.08",
                    profitMargin: 30.0
                }
            ];
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(parseFloat(amount));
        }

        function updateMetrics(salesData) {
            const totals = salesData.reduce((acc, emp) => {
                acc.sales += parseFloat(emp.totalSales);
                acc.orders += parseInt(emp.orderCount);
                acc.profit += parseFloat(emp.totalProfit);
                return acc;
            }, { sales: 0, orders: 0, profit: 0 });

            document.getElementById('totalSales').textContent = formatCurrency(totals.sales);
            document.getElementById('totalOrders').textContent = totals.orders;
            document.getElementById('avgOrderValue').textContent = formatCurrency(totals.sales / totals.orders || 0);
            document.getElementById('totalProfit').textContent = formatCurrency(totals.profit);
        }

        function renderEmployeeTable(salesData) {
            const tbody = document.getElementById('employeeTableBody');
            tbody.innerHTML = '';

            salesData.forEach((employee, index) => {
                const row = document.createElement('tr');
                const rankClass = index < 3 ? 'rank top3' : 'rank';
                
                row.innerHTML = `
                    <td><span class="${rankClass}">${index + 1}</span></td>
                    <td>${employee.employeeName}</td>
                    <td>${employee.employeeRole}</td>
                    <td>${formatCurrency(employee.totalSales)}</td>
                    <td>${employee.orderCount}</td>
                    <td>${formatCurrency(employee.averageOrderValue)}</td>
                    <td>${formatCurrency(employee.totalProfit)}</td>
                    <td>${employee.profitMargin ? employee.profitMargin.toFixed(1) + '%' : 'N/A'}</td>
                    <td>
                        <button onclick="viewEmployeeDetails('${employee.employeeId}')">
                            View Details
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        async function loadSalesData() {
            const period = document.getElementById('periodSelect').value;
            const loadingMessage = document.getElementById('loadingMessage');
            const employeeTable = document.getElementById('employeeTable');
            const errorMessage = document.getElementById('errorMessage');

            // Show loading state
            loadingMessage.style.display = 'block';
            employeeTable.style.display = 'none';
            errorMessage.style.display = 'none';

            try {
                // In a real implementation, replace this with:
                // const response = await fetch(`/api/employees/sales?period=${period}`);
                // const salesData = await response.json();
                
                const salesData = await fetchEmployeeSales(period);
                
                updateMetrics(salesData);
                renderEmployeeTable(salesData);
                
                loadingMessage.style.display = 'none';
                employeeTable.style.display = 'table';
            } catch (error) {
                console.error('Error loading sales data:', error);
                errorMessage.textContent = 'Failed to load sales data. Please try again.';
                errorMessage.style.display = 'block';
                loadingMessage.style.display = 'none';
            }
        }

        function viewEmployeeDetails(employeeId) {
            // In a real implementation, this would navigate to a detailed view
            // or open a modal with detailed sales information
            alert(`View details for employee: ${employeeId}\n\nThis would show:\n- Individual order history\n- Performance trends\n- Product sales breakdown`);
            
            // Example of how to fetch detailed data:
            // fetch(`/api/employees/${employeeId}/sales?period=${period}&limit=50`)
            //   .then(response => response.json())
            //   .then(data => showEmployeeModal(data));
        }

        // Load initial data when page loads
        document.addEventListener('DOMContentLoaded', loadSalesData);

        // Reload data when period changes
        document.getElementById('periodSelect').addEventListener('change', loadSalesData);
    </script>
</body>
</html>